<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Patron Tygodnia — Codzienny Cytat UI</title>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    :root{
      /* Paleta i zmienne (Codzienny Cytat) */
      --bg:#9fc6e2; /* jasne błękity */
      --bg2:#cfe8f8;
      --navy:#1e3a8a;
      --white:#ffffff;
      --quote-grad-start:#3b5998;
      --quote-grad-end:#5a8dee;
      --autumn-start:#8B5A2B;
      --autumn-mid:#d15518;
      --autumn-end:#6b8e23;
      --point-blue:#2b7bd6;

      --container-w:420px; /* dopasowane do telefonu w pionie */
      --rounded:16px;
      --card-h:120px;
      --gap:14px;

      /* STRZAŁKA: większa niż poprzednio, ale wciąż kompaktowa */
      --external-size: clamp(26px, 6vw, 32px); /* trochę większa */
      --external-icon: clamp(12px, 3vw, 16px);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      min-height:100vh;
      background: linear-gradient(180deg,var(--bg) 0%, var(--bg2) 100%);
      font-family: Roboto, Arial, sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding: env(safe-area-inset-top,18px) env(safe-area-inset-right,12px) env(safe-area-inset-bottom,18px) env(safe-area-inset-left,12px);
      color: var(--navy);
    }

    /* Container (wygląd zgodny z Codzienny Cytat) */
    .container{
      width:100%;
      max-width:var(--container-w);
      background: var(--white);
      border-radius: var(--rounded);
      padding: clamp(12px, 4vw, 18px);
      box-shadow: 0 12px 36px rgba(6,21,52,0.12);
      border: 1px solid rgba(30,58,138,0.06);
      position:relative;
      overflow:auto;
      max-height: calc(100vh - 36px);
      margin: 8px auto;
      transform-origin:center;
      opacity:0;
      transform:translateY(8px) scale(.995);
      animation: appIn .45s ease forwards;
      -webkit-overflow-scrolling: touch;
      touch-action: manipulation;
    }
    @keyframes appIn{ to{opacity:1;transform:none} }

    /* top-left external link (strzałka) - nieco większa */
    .external-link{
      position:absolute;
      top:12px;
      left:12px;
      width:var(--external-size);
      height:var(--external-size);
      border-radius:999px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      text-decoration:none;
      background:linear-gradient(135deg,var(--quote-grad-start) 0%,var(--quote-grad-end) 100%);
      box-shadow:0 8px 22px rgba(6,21,52,0.14);
      transition:transform .14s ease, box-shadow .14s ease, opacity .12s ease;
      z-index:1000;
      border:1px solid rgba(255,255,255,0.06);
      outline:none;
    }
    .external-link:focus{ box-shadow:0 10px 28px rgba(6,21,52,0.18); }
    .external-link:hover{ transform:translateY(-2px) scale(1.04); box-shadow:0 16px 34px rgba(6,21,52,0.16); }
    .external-link:active{ transform:translateY(0) scale(.99) }
    .external-link svg{ width:var(--external-icon); height:var(--external-icon); display:block; fill:#ffffff; transform:rotate(180deg); }

    header{ display:flex; align-items:center; gap:12px; justify-content:center; margin-bottom:6px; text-align:center }
    h1{
      font-family: 'Pacifico', cursive;
      margin:0;
      color: var(--navy);
      font-size: clamp(20px, 6vw, 28px);
      line-height:1;
    }

    .patron-box{
      margin-top: var(--gap);
      background: linear-gradient(135deg,var(--quote-grad-start),var(--quote-grad-end));
      color: var(--white);
      padding: clamp(12px,3.6vw,18px);
      border-radius: 12px;
      min-height:100px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      text-align:center;
      box-shadow:0 12px 34px rgba(59,89,152,0.12);
      font-size: 1rem;
    }
    .patron-box h2{ margin:0; font-size:1.05rem; font-weight:800 }
    .patron-box p{ margin:6px 0 0 0; font-size:0.95rem; opacity:0.95 }

    .controls{
      display:flex;
      gap:10px;
      margin-top: var(--gap);
      flex-direction:column;
    }

    /* przycisk -- inna czcionka dla napisu i mniejsza wysokość */
    .btn-primary{
      appearance:none;
      border: none;
      border-radius: 12px;
      padding: 10px 14px; /* krótszy w pionie */
      font-weight:800;
      font-size:1rem;
      font-family: 'Pacifico', cursive; /* inna czcionka dla napisu */
      line-height:1; /* krótszy w pionie */
      background: linear-gradient(90deg,var(--quote-grad-start),var(--quote-grad-end));
      color:var(--white);
      cursor:pointer;
      box-shadow: 0 10px 20px rgba(59,89,152,0.12);
      transition: transform .12s ease, box-shadow .12s ease;
      width:100%;
      min-height:38px; /* kompaktowy, wygodny dla palca */
    }
    .btn-primary:active{ transform: translateY(1px) }
    .btn-primary:disabled{ background:#c4c4c4; cursor:not-allowed; box-shadow:none; color:#fff; }

    .meta{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-top:10px;
    }
    #countdown { font-weight:700; color:var(--navy); font-size:0.95rem; text-align:center; margin-top:6px }

    .panel{
      margin-top:14px;
      background: linear-gradient(180deg,#f8fbff,#ffffff);
      border-radius:10px;
      padding:10px;
      border:1px solid rgba(30,58,138,0.06);
      box-shadow: 0 8px 18px rgba(30,58,138,0.04);
    }

    .history-header{ display:flex; align-items:center; justify-content:space-between; gap:8px }
    .history-list{
      margin-top:10px;
      max-height:220px;
      overflow:auto;
      -webkit-overflow-scrolling:touch;
      border-radius:8px;
      padding:6px;
      background: #fff;
      border:1px solid rgba(30,58,138,0.04);
    }
    .history-item{
      padding:10px;
      border-radius:8px;
      background:linear-gradient(180deg, rgba(59,89,152,0.03), rgba(59,89,152,0.01));
      margin-bottom:8px;
      font-size:0.95rem;
    }
    .history-item small{ display:block;color:rgba(30,58,138,0.6); margin-top:6px; font-size:0.82rem }

    .history-controls{ display:flex; gap:8px; margin-top:10px; justify-content:flex-end; flex-wrap:wrap }
    .btn-small{
      border-radius:10px;
      padding:8px 10px;
      border:1px solid rgba(30,58,138,0.06);
      background:transparent;
      color:var(--navy);
      cursor:pointer;
      font-weight:700;
    }

    .muted{ color:rgba(30,58,138,0.7); font-size:0.92rem; text-align:center; margin-top:10px }

    /* entry animations */
    @keyframes slideInFromLeft{from{opacity:0;transform:translateX(-28px)}to{opacity:1;transform:none}}
    header{opacity:0;animation:slideInFromLeft .5s cubic-bezier(.2,.9,.2,1) forwards .08s}
    .patron-box{opacity:0;animation:slideInFromLeft .55s cubic-bezier(.2,.9,.2,1) forwards .16s}
    .controls{opacity:0;animation:slideInFromLeft .55s cubic-bezier(.2,.9,.2,1) forwards .24s}
    .panel{opacity:0;animation:slideInFromLeft .55s cubic-bezier(.2,.9,.2,1) forwards .32s}
    footer{opacity:0;animation:slideInFromLeft .55s cubic-bezier(.2,.9,.2,1) forwards .40s}

    /* Mobile portrait tuning */
    @media (orientation: portrait) and (max-width:520px){
      :root{ --container-w: calc(100vw - 24px); }
      .container{ max-width: calc(100vw - 24px); padding:12px; border-radius:14px }
      .patron-box{ min-height:120px; padding:12px }
      .btn-primary{ min-height:40px; padding:10px 12px; font-size:1rem }
      .history-list{ max-height:180px }
      .external-link{ top:10px; left:10px }
    }

    @media (min-width:700px){
      .controls{flex-direction:row}
      .meta{justify-content:space-between}
    }

  </style>
</head>
<body>
  <div class="container" role="main" aria-label="Aplikacja Patron Tygodnia">
    <!-- top-left arrow linking do bloga (większa) -->
    <a class="external-link" href="https://blogwpg.my.canva.site/" target="_blank" rel="noopener" aria-label="Odwiedź blog">
      <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"/></svg>
    </a>

    <header>
      <h1>Patron Tygodnia</h1>
    </header>

    <div class="patron-box" id="patronBox" aria-live="polite">
      <p>Kliknij „Losuj Patrona” aby otrzymać patrona na ten tydzień.</p>
    </div>

    <div class="controls" role="region" aria-label="Kontrolki">
      <button id="drawBtn" class="btn-primary" onclick="drawPatron()">Losuj Patrona</button>
    </div>

    <div id="countdown" aria-hidden="false"></div>

    <div class="panel" aria-label="Historia wylosowań">
      <div class="history-header">
        <strong>Historia (ostatnie 6)</strong>
      </div>

      <div class="history-list" id="historyList" aria-live="polite">
        <!-- wpisy historii -->
      </div>

      <div class="history-controls">
        <button id="toggleHistoryBtn" class="btn-small" onclick="toggleHistory()">Pokaż więcej</button>
        <button class="btn-small" onclick="clearHistoryConfirm()">Wyczyść historię</button>
      </div>
    </div>

    <div class="muted">Codzienna krótka modlitwa pomaga w duchowym wzroście.</div>
  </div>

  <script>
    // --- lista 50 dobrze znanych świętych i błogosławionych (na 100% katolickich) ---
    const patrons = [
      { name: "św. Carlo Acutis", prayer: "Święty Carlo, pomagaj mi kochać Eucharystię i żyć w prawdzie." },
      { name: "św. Jan Paweł II", prayer: "Święty Janie Pawle, wstawiaj się za młodymi i rodzinami." },
      { name: "św. Teresa z Lisieux", prayer: "Święta Tereso, ucz mnie małej drogi miłości." },
      { name: "św. Franciszek z Asyżu", prayer: "Święty Franciszku, naucz mnie miłości do stworzeń." },
      { name: "św. Antoni z Padwy", prayer: "Święty Antoni, pomóż odnaleźć to, co zgubione." },
      { name: "św. Józef", prayer: "Święty Józefie, opiekuj się moją rodziną." },
      { name: "św. Jan Chrzciciel", prayer: "Święty Janie, przygotuj serce na Pana." },
      { name: "św. Paweł Apostoł", prayer: "Święty Pawle, naucz mnie odwagi w głoszeniu Ewangelii." },
      { name: "św. Piotr Apostoł", prayer: "Święty Piotrze, prowadź Kościół i chroń moją wiarę." },
      { name: "św. Teresa z Ávili", prayer: "Święta Tereso, wstawiaj się za moją modlitwą." },
      { name: "św. Ignacy z Loyoli", prayer: "Święty Ignacy, prowadź moje rozeznanie." },
      { name: "św. Tomasz z Akwinu", prayer: "Święty Tomaszu, oświeć mój umysł" },
      { name: "św. Benedykt z Nursji", prayer: "Święty Benedykcie, błogosław pracy i modlitwie." },
      { name: "św. Klara z Asyżu", prayer: "Święta Klaro, pomóż mi trwać w prostocie." },
      { name: "św. Maksymilian Kolbe", prayer: "Święty Maksymilianie, ucz mnie poświęcenia dla innych." },
      { name: "św. Faustyna Kowalska", prayer: "Święta Faustyno, prowadź mnie do zaufania Bożemu miłosierdziu." },
      { name: "św. Pio z Pietrelciny (Padre Pio)", prayer: "Święty Pio, otaczaj opieką chorych i cierpiących." },
      { name: "św. Jan Maria Vianney (Proboszcz z Ars)", prayer: "Święty Janie Marie, naucz mnie miłości do sakramentów." },
      { name: "św. Bernadetta Soubirous", prayer: "Święta Bernadetto, wstawiaj się za nami z Lourdes." },
      { name: "św. Maria Magdalena", prayer: "Święta Mario Magdaleno, naucz mnie wiernej miłości do Pana." },
      { name: "św. Józef Sebastian Pelczar", prayer: "Święty Józefie Sebastianie, błogosław dzieła miłosierdzia." },
      { name: "św. Edmund Bojanowski", prayer: "Święty Edmundzie, wspieraj dzieła miłości i edukacji." },
      { name: "św. Jadwiga Królowa", prayer: "Święta Jadwigo, opiekuj się Polską i rodzinami." },
      { name: "św. Kazimierz", prayer: "Święty Kazimierzu, wspieraj młodych w cnocie." },
      { name: "św. Stanisław ze Szczepanowa", prayer: "Święty Stanisławie, wstawiaj się za wiernymi." },
      { name: "św. Stanisław Kostka", prayer: "Święty Stanisławie, pomagaj młodzieży w wyborach życiowych." },
      { name: "św. Andrzej Bobola", prayer: "Święty Andrzeju, umacniaj wierność i odwagę." },
      { name: "św. Teresa Benedykta od Krzyża (Edith Stein)", prayer: "Święta Tereso Benedykto, módl się za dialog i prawdę." },
      { name: "św. Kamil de Lellis", prayer: "Święty Kamilie, wstawiaj się za chorych i służbę zdrowia." },
      { name: "św. Wincenty a Paulo", prayer: "Święty Wincenty, obdarz mnie miłością służby." },
      { name: "św. Alfons Maria Liguori", prayer: "Święty Alfonsie, prowadź w drodze nawrócenia." },
      { name: "św. Rita z Cascii", prayer: "Święta Rito, módl się w trudnych sprawach." },
      { name: "św. Alojzy Gonzaga", prayer: "Święty Alojzy, wspieraj młodzież w powołaniu." },
      { name: "św. Jan XXIII", prayer: "Święty Janie XXIII, módl się za odnowę Kościoła." },
      { name: "św. Paweł VI", prayer: "Święty Pawle VI, wstawiaj się za Kościół i pokój." },
      { name: "św. Filip Neri", prayer: "Święty Filipie, obdarz mnie radością służby." },
      { name: "św. Łucja", prayer: "Święta Łucjo, oświeć moje serce i oczy." },
      { name: "św. Cecylia", prayer: "Święta Cecylio, niech moja modlitwa będzie śpiewem." },
      { name: "św. Mikołaj", prayer: "Święty Mikołaju, opiekuj się rodzinami i dziećmi." },
      { name: "św. Józef Marello", prayer: "Święty Józefie Marello, wspieraj gorliwość misyjną." },
      { name: "św. Rafał Kalinowski", prayer: "Święty Rafale, ucz pokory i wytrwałości." },
      { name: "św. Jan Paweł I", prayer: "Święty Janie Pawle I, wstawiaj się za Kościół." },
      { name: "św. Oscar Romero", prayer: "Święty Óscarze, wstawiaj się za sprawiedliwością społeczną." },
      { name: "bł. Carlo Acutis" , prayer: "Błogosławiony Carlo, módl się za młodych (uwaga: Carlo jest kanonizowany — preferowany zapis jako św. Carlo Acutis, jeśli chcesz)." },
      { name: "bł. Matt Talbot", prayer: "Błogosławiony Matie, wstawiaj się w sprawach uzależnień." },
      { name: "bł. Jerzy Popiełuszko", prayer: "Błogosławiony Jerzy, wstawiaj się za wolnością i odwagą." }
    ];

    // jeśli użytkownik życzy sobie, mogę usunąć wpisy 'bł.' i zamienić na 'św.' dla kanonizowanych — zostawiłem kilka błogosławionych, jak poprosiłeś

    // --- elementy DOM ---
    const drawBtn = document.getElementById('drawBtn');
    const patronBox = document.getElementById('patronBox');
    const countdownDiv = document.getElementById('countdown');
    const historyList = document.getElementById('historyList');
    const toggleHistoryBtn = document.getElementById('toggleHistoryBtn');

    // --- stan i funkcje ---
    const WEEK_MS = 7 * 24 * 60 * 60 * 1000;
    let countdownIntervalId = null;
    const HISTORY_SHOW = 6;
    let historyExpanded = false;

    function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

    function renderPatron(p){
      patronBox.innerHTML = `<h2>${escapeHtml(p.name)}</h2><p>${escapeHtml(p.prayer)}</p>`;
    }

    function pushHistory(entry){
      const raw = localStorage.getItem('patronHistory');
      const arr = raw ? JSON.parse(raw) : [];
      arr.unshift(entry);
      if(arr.length > 200) arr.length = 200;
      localStorage.setItem('patronHistory', JSON.stringify(arr));
      renderHistory();
    }

    function renderHistory(){
      const raw = localStorage.getItem('patronHistory');
      const arr = raw ? JSON.parse(raw) : [];
      if(arr.length === 0){
        historyList.innerHTML = '<div class="history-item">Brak zapisów</div>';
        toggleHistoryBtn.style.display = 'none';
        return;
      }
      const toShow = historyExpanded ? arr : arr.slice(0, HISTORY_SHOW);
      historyList.innerHTML = toShow.map(h => {
        const dt = new Date(h.time);
        const dateStr = dt.toLocaleString();
        return `<div class="history-item"><strong>${escapeHtml(h.name)}</strong><small>${escapeHtml(h.prayer)}</small><small>${dateStr}</small></div>`;
      }).join('');
      if(arr.length > HISTORY_SHOW){
        toggleHistoryBtn.style.display = 'inline-block';
        toggleHistoryBtn.textContent = historyExpanded ? 'Pokaż mniej' : 'Pokaż więcej';
      } else {
        toggleHistoryBtn.style.display = 'none';
      }
    }

    function toggleHistory(){ historyExpanded = !historyExpanded; renderHistory(); }

    function clearHistoryConfirm(){ if(confirm('Na pewno usunąć całą historię wylosowań?')) { localStorage.removeItem('patronHistory'); renderHistory(); } }

    function getCurrentWeekIndex(){ return Math.floor(Date.now() / WEEK_MS); }

    function ensureWeeklyPatronOnLoad(){
      const storedWeek = localStorage.getItem('patronWeekIndex');
      const lastDraw = localStorage.getItem('lastDraw');
      const pName = localStorage.getItem('patronName');
      const pPrayer = localStorage.getItem('patronPrayer');

      if(storedWeek && parseInt(storedWeek) === getCurrentWeekIndex() && lastDraw && pName && pPrayer){
        renderPatron({name: pName, prayer: pPrayer});
        startCountdown(parseInt(lastDraw));
        drawBtn.disabled = true;
      } else {
        drawBtn.disabled = false;
        countdownDiv.textContent = 'Jeszcze nie wylosowano patrona na ten tydzień.';
        localStorage.removeItem('patronWeekIndex');
      }
    }

    function drawPatron(){
      const idx = Math.floor(Math.random() * patrons.length);
      const p = patrons[idx];
      const now = Date.now();
      localStorage.setItem('patronName', p.name);
      localStorage.setItem('patronPrayer', p.prayer);
      localStorage.setItem('lastDraw', now.toString());
      localStorage.setItem('patronWeekIndex', getCurrentWeekIndex().toString());
      renderPatron(p);
      pushHistory({name: p.name, prayer: p.prayer, time: now});
      startCountdown(now);
      drawBtn.disabled = true;
    }

    function startCountdown(startTimestamp){
      if(countdownIntervalId){ clearInterval(countdownIntervalId); countdownIntervalId = null; }
      const nextDraw = parseInt(startTimestamp) + WEEK_MS;
      function tick(){
        const now = Date.now();
        const distance = nextDraw - now;
        if(distance <= 0){
          countdownDiv.textContent = "Możesz już losować nowego patrona!";
          drawBtn.disabled = false;
          clearInterval(countdownIntervalId);
          countdownIntervalId = null;
          return;
        }
        const days = Math.floor(distance / (1000*60*60*24));
        const hours = Math.floor((distance % (1000*60*60*24)) / (1000*60*60));
        const minutes = Math.floor((distance % (1000*60*60)) / (1000*60));
        const seconds = Math.floor((distance % (1000*60)) / 1000);
        countdownDiv.textContent = `Możesz losować ponownie za: ${days}d ${hours}h ${minutes}m ${seconds}s`;
      }
      tick();
      countdownIntervalId = setInterval(tick, 1000);
    }

    function init(){
      renderHistory();
      ensureWeeklyPatronOnLoad();
      drawBtn.setAttribute('aria-label', 'Losuj patrona na tydzień');
      console.info('Patron Tygodnia — zaktualizowano listę patronów oraz responsywność i strzałkę.');
    }
    init();
  </script>
</body>
</html>

