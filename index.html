<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Patron Tygodnia — Ustawienia kolorów</title>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{
      /* default: Niebieski */
      --bg: #9fc6e2;
      --bg2: #cfe8f8;
      --navy: #1e3a8a;
      --quote-grad-start: #3b5998;
      --quote-grad-end: #5a8dee;
      --point-blue: #2b7bd6;

      --card: rgba(255,255,255,0.92); /* cards remain white / semi-transparent */
      --radius-min: 8px;
      --radius-max: 16px;
      --shadow-1: 0 10px 30px rgba(6,21,52,0.12);
      --shadow-2: 0 6px 18px rgba(59,89,152,0.12);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Roboto, system-ui, -apple-system, 'Segoe UI', Arial;
      background: linear-gradient(180deg,var(--bg),var(--bg2));
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:12px;
      color:var(--navy);
    }

    .app{
      width:100%;
      max-width:720px;
      border-radius:18px;
      padding:14px;
      background: var(--card); /* white modal */
      box-shadow: var(--shadow-1), var(--shadow-2);
      backdrop-filter: blur(6px) saturate(110%);
      max-height: 90vh; /* shortened */
      display:flex;
      flex-direction:column;
      gap:12px;
      overflow:auto;
    }

    header{ text-align:center }
    header h1{
      margin:10px 0 0 0;
      font-family: 'Pacifico', cursive;
      color:var(--navy);
      font-size:34px;
      letter-spacing:0.6px;
    }
    header p.lead{
      margin:6px 0 0 0;
      font-size:13px;
      color:rgba(30,58,138,0.9);
    }

    .card{
      background: var(--card); /* enforced semi-transparent white */
      border-radius:var(--radius-max);
      padding:14px;
      color:var(--navy);
      box-shadow: 0 10px 28px rgba(35,63,114,0.06);
      transform-origin:center;
      overflow:hidden;
      position:relative;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .ticker-area{
      border-radius:12px;
      padding:12px;
      min-height:96px;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      background: linear-gradient(180deg, rgba(59,89,238,0.04), rgba(90,141,238,0.02));
    }

    .ticker{
      text-align:center;
      width:100%;
      padding:8px 6px;
      border-radius:10px;
    }
    .ticker .name{
      font-weight:700;
      font-size:20px;
      color:var(--navy);
      opacity:0.98;
      transition: opacity .12s ease, transform .12s ease;
      word-break:break-word;
    }
    .ticker .prayer{
      margin-top:8px;
      font-weight:400;
      font-size:14px;
      color:rgba(30,58,138,0.9);
      opacity:0.9;
      transition: opacity .12s ease, transform .12s ease;
    }

    /* flashing / cycling effect */
    .flash-in{ animation:flashIn .18s ease forwards; }
    .flash-out{ animation:flashOut .18s ease forwards; }
    @keyframes flashIn{ from{opacity:0; transform:translateY(6px) scale(.995)} to{opacity:1; transform:translateY(0) scale(1)} }
    @keyframes flashOut{ from{opacity:1; transform:translateY(0) scale(1)} to{opacity:0; transform:translateY(-6px) scale(.995)} }

    .controls{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:center;
      flex-wrap:wrap;
    }

    .btn{
      border:0;
      padding:12px 18px;
      border-radius:12px;
      font-weight:700;
      font-size:15px;
      cursor:pointer;
      display:inline-flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      box-shadow:var(--shadow-2);
      background: linear-gradient(90deg, var(--quote-grad-start), var(--quote-grad-end));
      color:white;
      transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease;
      min-width:140px;
    }
    .btn.secondary{ background: var(--card); color:var(--navy); border:1px solid rgba(6,21,52,0.06); box-shadow: var(--shadow-2); }
    .btn:active{transform:translateY(1px) scale(.997)}
    .btn[disabled]{opacity:0.6; cursor:not-allowed}

    .dots{display:inline-flex;gap:6px;align-items:center;height:12px}
    .dot{width:6px;height:6px;border-radius:50%;background:white;opacity:.9;animation:dotPulse 1s infinite}
    .dot:nth-child(2){animation-delay:.15s}
    .dot:nth-child(3){animation-delay:.3s}
    @keyframes dotPulse{0%{transform:scale(.6);opacity:.6}50%{transform:scale(1.1);opacity:1}100%{transform:scale(.6);opacity:.6}}

    .countdown{
      color:var(--navy);
      font-weight:700;
      font-size:13px;
      background: rgba(30,58,138,0.04);
      padding:8px 10px;
      border-radius:10px;
    }

    /* history modal (glass) */
    .overlay{
      position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:transparent;z-index:40;padding:18px;
    }
    .overlay.show{display:flex}
    .history-card{
      width:100%;max-width:560px;
      /* glass effect */
      background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.06));
      border-radius:14px;
      padding:14px;
      position:relative;
      max-height:70vh;
      overflow:auto;
      backdrop-filter: blur(12px) saturate(120%);
      border: 1px solid rgba(255,255,255,0.75);
      box-shadow: 0 8px 30px rgba(255,255,255,0.08), 0 18px 48px rgba(6,21,52,0.06);
    }
    .history-card h3{margin:0 0 8px 0;font-size:18px;font-weight:700;color:var(--navy)}
    .close-x{position:absolute;right:12px;top:10px;border:0;background:transparent;font-size:20px;cursor:pointer;color:var(--navy)}
    .history-list{display:flex;flex-direction:column;gap:10px;margin-top:10px}
    .history-item{padding:10px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.04),rgba(255,255,255,0.02));}
    .history-meta{font-size:12px;color:rgba(30,58,138,0.7);margin-bottom:6px}

    /* SETTINGS UI */
    .settings-btn{
      position:fixed;right:18px;top:50%;transform:translateY(-50%);
      width:56px;height:56px;border-radius:50%;
      background:rgba(255,255,255,0.12);backdrop-filter:blur(8px) saturate(120%);
      display:flex;align-items:center;justify-content:center;box-shadow:0 8px 30px rgba(6,21,52,0.08);
      border:1px solid rgba(255,255,255,0.18);z-index:60;cursor:pointer
    }
    .settings-btn svg{width:22px;height:22px;opacity:0.98;fill:var(--navy)}
    .settings-emoji{font-size:22px;line-height:1;color:var(--navy)}

    .settings-panel{
      position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:transparent;z-index:61;padding:18px;
      /* zamiast przyciemnienia — blur tła */
      backdrop-filter: blur(8px) saturate(120%);
      -webkit-backdrop-filter: blur(8px) saturate(120%);
    }
    .settings-panel.show{display:flex}
    .settings-card{
      width:360px;max-width:92vw;background:linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.04));
      border-radius:14px;padding:12px;backdrop-filter: blur(12px) saturate(120%);box-shadow:0 12px 36px rgba(6,21,52,0.14);position:relative;max-height:70vh;overflow:auto;border:1px solid rgba(255,255,255,0.75);
    }
    .settings-card h4{margin:4px 0 8px 0;color:var(--navy);font-size:15px} 
    .settings-panel h4{margin:4px 0 8px 0;color:var(--navy);font-size:15px}

    .theme-list{display:flex;flex-direction:column;gap:8px;max-height:60vh;overflow:auto;padding-right:6px}
    .theme-tile{display:flex;gap:10px;align-items:center;padding:8px;border-radius:10px;cursor:pointer;border:1px solid transparent}
    .theme-tile:hover{transform:translateY(-2px);}
    .theme-preview{width:72px;height:44px;border-radius:8px;flex:0 0 72px;box-shadow:0 6px 18px rgba(6,21,52,0.06);overflow:hidden}
    .theme-info{display:flex;flex-direction:column}
    .theme-name{font-weight:700;color:var(--navy);font-size:13px}
    .theme-meta{font-size:12px;color:rgba(30,58,138,0.7)}
    .theme-radio{margin-left:auto}

    /* responsive small screens */
    @media (max-width:520px){
      .settings-btn{right:12px;top:auto;bottom:18px;transform:none}
      /* keep modal centered on small screens, just reduce padding */
      .settings-panel{padding:12px}
      header h1{font-size:30px}
      .ticker .name{font-size:18px}
      .ticker .prayer{font-size:14px}
      .controls{flex-direction:column}
      .btn{width:100%}
      .history-card{padding:12px}
    }
  </style>
</head>
<body>
  <main class="app" role="main">
    <header>
      <h1>Patron Tygodnia</h1>
      <p class="lead">Wylosuj swojego patrona — jeden na tydzień. Kliknij „Losuj” i poczuj, który patron dziś Ci towarzyszy.</p>
    </header>

    <section class="card" aria-labelledby="card-title">
      <div style="min-height:6px"></div>

      <div class="ticker-area" aria-live="polite">
        <div class="ticker" id="ticker">
          <div class="name" id="tickerName">—</div>
          <div class="prayer" id="tickerPrayer"></div>
        </div>
      </div>

      <div class="controls">
        <button id="drawBtn" class="btn" aria-live="polite"><span id="btnText">Losuj</span><span id="btnDots" style="display:none" class="dots" aria-hidden="true"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span></button>
        <div id="countdown" class="countdown" style="display:none">Możesz losować ponownie za: 7d 00:00:00</div>
      </div>

      <!-- small hint area (optional) -->
      <div id="hint" style="font-size:13px;color:rgba(30,58,138,0.7);text-align:center">Naciśnij "Historia Patronów", aby zobaczyć swoich poprzednich wylosowanych Świętych lub Błogosławionych</div>
    </section>

    <!-- history button placed below everything -->
    <div style="display:flex;justify-content:center;margin-top:6px">
      <button id="historyBtn" class="btn secondary">Historia Patronów</button>
    </div>
  </main>

  <!-- settings floating button -->
  <button id="settingsBtn" class="settings-btn" title="Ustawienia" aria-label="Ustawienia">
    <span class="settings-emoji" aria-hidden="true">⚙️</span>
  </button>

  <div id="settingsPanel" class="settings-panel" role="dialog" aria-hidden="true">
    <div class="settings-card" role="document">
      <button class="close-x" id="closeSettings" aria-label="Zamknij">✕</button>
      <h4>Motyw kolorystyczny</h4>
      <div class="theme-list" id="themeList"></div>
    </div>
  </div> 
  </div>

  <!-- history modal -->
  <div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="history-card" role="document">
      <button class="close-x" id="closeHistory" aria-label="Zamknij">✕</button>
      <h3>Historia Patronów</h3>
      <div id="historyList" class="history-list"></div>
    </div>
  </div>

  <script>
    const patrons = [
      {name: 'Św. Antoni Padewski', prayer: 'módl się za mną o odnalezienie dobra w każdej zagubionej chwili.'},
      {name: 'Św. Rita z Cascii', prayer: 'módl się za mną o pokój w trudnościach, które wydają się niemożliwe.'},
      {name: 'Św. Ojciec Pio', prayer: 'módl się nade mną o siłę, gdy serce się męczy.'},
      {name: 'Św. Franciszek z Asyżu', prayer: 'módl się za mną o łagodność i wdzięk w codzienności.'},
      {name: 'Św. Jan Paweł II', prayer: 'módl się nade mną o odwagę i serce otwarte na ludzi.'},
      {name: 'Św. Teresa z Lisieux', prayer: 'módl się za mną o prostą, cichą radość.'},
      {name: 'Św. Józef', prayer: 'módl się nade mną o stabilność, spokój i mądrą troskę.'},
      {name: 'Św. Michał Archanioł', prayer: 'módl się za mną o ochronę przed tym, co mroczne.'},
      {name: 'Św. Faustyna Kowalska', prayer: 'módl się nade mną o ufność, nawet gdy świat drży.'},
      {name: 'Św. Katarzyna ze Sieny', prayer: 'módl się za mną o jasność myśli i serca.'},
      {name: 'Św. Stanisław Kostka', prayer: 'módl się nade mną o młodzieńczą odwagę i świeże siły.'},
      {name: 'Św. Jadwiga Królowa', prayer: 'módl się za mną o mądrość w trudnych decyzjach.'},
      {name: 'Bł. Carlo Acutis', prayer: 'módl się nade mną o czystość intencji i pogodę ducha.'},
      {name: 'Św. Ojciec Maksymilian Kolbe', prayer: 'módl się za mną o miłość zdolną do poświęceń.'},
      {name: 'Św. Benedykta od Krzyża (Edyta Stein)', prayer: 'módl się nade mną o głębię wiary i rozumu.'},
      {name: 'Św. Ignacy Loyola', prayer: 'módl się za mną o rozeznanie drogi, którą mam iść.'},
      {name: 'Św. Brat Albert Chmielowski', prayer: 'módl się nade mną o serce hojniejsze niż moje lęki.'},
      {name: 'Św. Filomena', prayer: 'módl się za mną o nadzieję nawet w cieniu smutku.'},
      {name: 'Bł. Pier Giorgio Frassati', prayer: 'módl się nade mną o radość, która pociąga ku dobru.'}
    ];

    const tickerName = document.getElementById('tickerName');
    const tickerPrayer = document.getElementById('tickerPrayer');
    const drawBtn = document.getElementById('drawBtn');
    const btnText = document.getElementById('btnText');
    const btnDots = document.getElementById('btnDots');
    const countdownBox = document.getElementById('countdown');
    const historyBtn = document.getElementById('historyBtn');
    const overlay = document.getElementById('overlay');
    const closeHistory = document.getElementById('closeHistory');
    const historyList = document.getElementById('historyList');

    const settingsBtn = document.getElementById('settingsBtn');
    const settingsPanel = document.getElementById('settingsPanel');
    // themeListEl will be queried inside buildThemeList() to avoid timing surprises

    const DRAW_DURATION = 4000; // ms
    const WEEK_MS = 7 * 24 * 60 * 60 * 1000;
    const STORAGE_KEY = 'patron_unlock_ts_v3';
    const LAST_SELECTED_KEY = 'patron_last_selected_v3';
    const HISTORY_KEY = 'patron_history_v3';
    const THEME_KEY = 'patron_theme_v1';

    let cycleInterval = null;

    function setTicker(item){
      // animate change
      tickerName.classList.remove('flash-in','flash-out');
      tickerPrayer.classList.remove('flash-in','flash-out');
      tickerName.classList.add('flash-out');
      tickerPrayer.classList.add('flash-out');
      setTimeout(()=>{
        tickerName.textContent = item.name;
        tickerPrayer.textContent = item.prayer;
        tickerName.classList.remove('flash-out');
        tickerPrayer.classList.remove('flash-out');
        tickerName.classList.add('flash-in');
        tickerPrayer.classList.add('flash-in');
      }, 140);
    }

    function startCountdown(untilTs){
      countdownBox.style.display='inline-block';
      let intervalHandle = null;
      function tick(){
        const now = Date.now();
        const diff = untilTs - now;
        if(diff<=0){
          countdownBox.style.display='none';
          drawBtn.disabled=false;
          localStorage.removeItem(STORAGE_KEY);
          if(intervalHandle) clearInterval(intervalHandle);
          return;
        }
        const days = Math.floor(diff / (24*60*60*1000));
        const h = Math.floor((diff % (24*60*60*1000)) / (60*60*1000));
        const m = Math.floor((diff % (60*60*1000)) / (60*1000));
        const s = Math.floor((diff % (60*1000)) / 1000);
        countdownBox.textContent = `Możesz losować ponownie za: ${days}d ${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
      }
      tick();
      intervalHandle = setInterval(tick,1000);
    }

    function disableWhileDrawing(){
      drawBtn.disabled=true;
      btnText.textContent='Losowanie...';
      btnDots.style.display='inline-flex';
    }
    function enableAfterDrawing(){
      btnDots.style.display='none';
      btnText.textContent='Losuj';
    }

    function cycleTexts(speed=120){
      let i = 0;
      cycleInterval = setInterval(()=>{
        const item = patrons[i % patrons.length];
        setTicker(item);
        i++;
      }, speed);
    }

    function stopCycle(){
      if(cycleInterval) { clearInterval(cycleInterval); cycleInterval = null; }
    }

    function saveHistory(item){
      try{
        const raw = localStorage.getItem(HISTORY_KEY);
        const arr = raw ? JSON.parse(raw) : [];
        arr.unshift({ts:Date.now(), name:item.name, prayer:item.prayer});
        localStorage.setItem(HISTORY_KEY, JSON.stringify(arr.slice(0,50))); // keep last 50
      }catch(e){console.warn(e)}
    }

    function renderHistory(){
      const raw = localStorage.getItem(HISTORY_KEY);
      const arr = raw ? JSON.parse(raw) : [];
      historyList.innerHTML='';
      if(arr.length===0){
        historyList.innerHTML = '<div style="color:rgba(30,58,138,0.7)">Brak historii.</div>';
        return;
      }
      arr.forEach(h =>{
        const item = document.createElement('div');
        item.className='history-item';
        const d = new Date(h.ts);
        const meta = document.createElement('div'); meta.className='history-meta'; meta.textContent = `${d.toLocaleString()}`;
        const title = document.createElement('div'); title.style.fontWeight='700'; title.textContent = h.name;
        const prayer = document.createElement('div'); prayer.style.marginTop='6px'; prayer.style.fontSize='13px'; prayer.style.color='rgba(30,58,138,0.85)'; prayer.textContent = h.prayer;
        item.appendChild(meta); item.appendChild(title); item.appendChild(prayer);
        historyList.appendChild(item);
      });
    }

    function openHistory(){ renderHistory(); overlay.classList.add('show'); overlay.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; }
    function closeHistoryModal(){ overlay.classList.remove('show'); overlay.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }

    function draw(){
      disableWhileDrawing();
      cycleTexts(100);

      setTimeout(()=>{
        stopCycle();
        const chosen = patrons[Math.floor(Math.random()*patrons.length)];
        setTicker(chosen);
        // persist last selection
        localStorage.setItem(LAST_SELECTED_KEY, JSON.stringify(chosen));
        saveHistory(chosen);
        const unlockTs = Date.now() + WEEK_MS;
        localStorage.setItem(STORAGE_KEY, String(unlockTs));
        startCountdown(unlockTs);
        enableAfterDrawing();
      }, DRAW_DURATION);
    }

    // events
    drawBtn.addEventListener('click', ()=>{ if(drawBtn.disabled) return; draw(); });
    historyBtn.addEventListener('click', openHistory);
    closeHistory.addEventListener('click', closeHistoryModal);
    overlay.addEventListener('click', (e)=>{ if(e.target === overlay) closeHistoryModal(); });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') { closeHistoryModal(); hideSettings(); } });

    // THEMES definition (rainbow order) — keys and variables
    const THEMES = [
      {
        id:'dojrzala-dynia', name:'Dojrzała dynia', vars:{
          '--bg':'#ff6b35','--bg2':'#ffedd5','--navy':'#7c2d12','--quote-grad-start':'#ea580c','--quote-grad-end':'#dc2626','--point-blue':'#C2410c'
        }
      },
      { id:'pomaranczowy', name:'Pomarańczowy', vars:{ '--bg':'#fed7aa','--bg2':'#fef3c7','--navy':'#92400e','--quote-grad-start':'#f59e0b','--quote-grad-end':'#f97316','--point-blue':'#d97706' } },
      { id:'zolty', name:'Żółty', vars:{ '--bg':'#fef08a','--bg2':'#fef9c3','--navy':'#713f12','--quote-grad-start':'#eab308','--quote-grad-end':'#facc15','--point-blue':'#ca8a04' } },
      { id:'musztardziany', name:'Musztardziany', vars:{ '--bg':'#d4a574','--bg2':'#e8c9a1','--navy':'#5a3e1b','--quote-grad-start':'#b8860b','--quote-grad-end':'#daa520','--point-blue':'#996515' } },
      { id:'zielony', name:'Zielony', vars:{ '--bg':'#a7f3d0','--bg2':'#d1fae5','--navy':'#064e3b','--quote-grad-start':'#059669','--quote-grad-end':'#10b981','--point-blue':'#047857' } },
      { id:'splesniala-zielen', name:'Spleśniała zieleń', vars:{ '--bg':'#8b9467','--bg2':'#a8b584','--navy':'#3d4a2b','--quote-grad-start':'#6b7c4f','--quote-grad-end':'#5a6b42','--point-blue':'#4a5635' } },
      { id:'jasny-turkus', name:'Jasny niebieski turkusowy', vars:{ '--bg':'#a5f3fc','--bg2':'#cffafe','--navy':'#164e63','--quote-grad-start':'#06b6d4','--quote-grad-end':'#0891b2','--point-blue':'#0e7490' } },
      { id:'jasny-blykit', name:'Jasny błękit', vars:{ '--bg':'#bfdbfe','--bg2':'#dbeafe','--navy':'#1e40af','--quote-grad-start':'#60a5fa','--quote-grad-end':'#3b82f6','--point-blue':'#2563eb' } },
      { id:'granatowy', name:'Granatowy', vars:{ '--bg':'#93c5fd','--bg2':'#bfdbfe','--navy':'#1e3a8a','--quote-grad-start':'#1e40af','--quote-grad-end':'#1e3a8a','--point-blue':'#1d4ed8' } },
      { id:'niebieski', name:'Niebieski (domyślny)', vars:{ '--bg':'#9fc6e2','--bg2':'#cfe8f8','--navy':'#1e3a8a','--quote-grad-start':'#3b5998','--quote-grad-end':'#5a8dee','--point-blue':'#2b7bd6' } },
      { id:'fioletowy', name:'Fioletowy', vars:{ '--bg':'#e9d5ff','--bg2':'#f3e8ff','--navy':'#581c87','--quote-grad-start':'#8b5cf6','--quote-grad-end':'#a855f7','--point-blue':'#7c3aed' } },
      { id:'sliwkowy', name:'Śliwkowy', vars:{ '--bg':'#c8b5d1','--bg2':'#e6d9ea','--navy':'#4a2c5a','--quote-grad-start':'#8e4a9c','--quote-grad-end':'#6b3775','--point-blue':'#7a4285' } },
      { id:'rozowy', name:'Różowy', vars:{ '--bg':'#fce7f3','--bg2':'#fdf2f8','--navy':'#831843','--quote-grad-start':'#db2777','--quote-grad-end':'#ec4899','--point-blue':'#be185d' } },
      { id:'jasny-rozowy', name:'Jasny różany', vars:{ '--bg':'#ffe4e6','--bg2':'#fef2f2','--navy':'#881337','--quote-grad-start':'#f43f5e','--quote-grad-end':'#e11d48','--point-blue':'#dc2626' } },
      { id:'bezowy', name:'Beżowy', vars:{ '--bg':'#f7f3e9','--bg2':'#fdf9f1','--navy':'#8b4513','--quote-grad-start':'#e6d7c3','--quote-grad-end':'#d4b896','--point-blue':'#c19a6b' } },
      { id:'spienione-latte', name:'Spienione latte', vars:{ '--bg':'#d4b896','--bg2':'#e8d5b7','--navy':'#5d4037','--quote-grad-start':'#8d6e63','--quote-grad-end':'#6d4c41','--point-blue':'#795548' } },
      { id:'szary', name:'Szary', vars:{ '--bg':'#e5e7eb','--bg2':'#f3f4f6','--navy':'#111827','--quote-grad-start':'#4b5563','--quote-grad-end':'#6b7280','--point-blue':'#374151' } },
      { id:'czarno-bialy', name:'Czarno-biały', vars:{ '--bg':'#ffffff','--bg2':'#f8f9fa','--navy':'#000000','--quote-grad-start':'#000000','--quote-grad-end':'#333333','--point-blue':'#666666' } }
    ];

    // create theme tiles in the panel
    function buildThemeList(){
      const themeListEl = document.getElementById('themeList');
      if(!themeListEl) return;
      themeListEl.innerHTML = '';
      THEMES.forEach(t =>{
        const tile = document.createElement('label');
        tile.className = 'theme-tile';
        tile.setAttribute('data-id', t.id);

        const preview = document.createElement('div'); preview.className='theme-preview';
        preview.style.background = `linear-gradient(135deg, ${t.vars['--bg']}, ${t.vars['--quote-grad-start']})`;

        const info = document.createElement('div'); info.className='theme-info';
        const name = document.createElement('div'); name.className='theme-name'; name.textContent = t.name;
        const meta = document.createElement('div'); meta.className='theme-meta'; meta.textContent = `${t.vars['--bg']} • ${t.vars['--quote-grad-start']}`;
        info.appendChild(name); info.appendChild(meta);

        const radio = document.createElement('input'); radio.type='radio'; radio.name='theme'; radio.className='theme-radio'; radio.value = t.id;

        tile.appendChild(preview); tile.appendChild(info); tile.appendChild(radio);

        tile.addEventListener('click', ()=>{ selectTheme(t.id); });

        themeListEl.appendChild(tile);
      });
    }

    function applyThemeVars(vars){
      Object.keys(vars).forEach(k=>{ document.documentElement.style.setProperty(k, vars[k]); });
      // ensure buttons update
      document.querySelectorAll('.btn').forEach(b=>{
        b.style.background = `linear-gradient(90deg, var(--quote-grad-start), var(--quote-grad-end))`;
      });
    }

    function selectTheme(id, persist=true){
      const t = THEMES.find(x=>x.id===id);
      if(!t) return;
      applyThemeVars(t.vars);
      // mark radio
      document.querySelectorAll('.theme-radio').forEach(r=> r.checked = (r.value===id));
      if(persist) localStorage.setItem(THEME_KEY, id);
    }

    function showSettings(){
      // rebuild the list each time in case the panel was empty
      buildThemeList();
      settingsPanel.classList.add('show'); settingsPanel.setAttribute('aria-hidden','false');
    }
    function hideSettings(){ settingsPanel.classList.remove('show'); settingsPanel.setAttribute('aria-hidden','true'); }

    settingsBtn.addEventListener('click', ()=>{
      if(settingsPanel.classList.contains('show')) hideSettings(); else showSettings();
    });

    // initialize
    window.addEventListener('load', ()=>{
      
      buildThemeList();
      // restore theme
      const storedTheme = localStorage.getItem(THEME_KEY);
      if(storedTheme && THEMES.find(t=>t.id===storedTheme)) selectTheme(storedTheme, false);
      else selectTheme('niebieski', false);

      const last = localStorage.getItem(LAST_SELECTED_KEY);
      const stored = localStorage.getItem(STORAGE_KEY);
      if(last){ try{ const obj = JSON.parse(last); setTicker(obj); }catch(e){} }
      if(stored){ const ts = Number(stored); if(!isNaN(ts) && ts > Date.now()){ drawBtn.disabled=true; startCountdown(ts);} else { localStorage.removeItem(STORAGE_KEY); drawBtn.disabled=false; } }
      // ensure mobile-friendly focus targets
    
      // wire closeSettings button for modal
      const closeSettingsBtn = document.getElementById('closeSettings');
      if(closeSettingsBtn) closeSettingsBtn.addEventListener('click', hideSettings);
      // ensure mobile-friendly focus targets
    });

    // settings: close if clicked away
    document.addEventListener('click', (e)=>{
      if(settingsPanel.classList.contains('show')){
        // if user clicked on the backdrop (settingsPanel itself), close modal
        if(e.target === settingsPanel) hideSettings();
      }
    });

  </script>
</body>
</html>


